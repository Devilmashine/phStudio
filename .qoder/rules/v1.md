---
trigger: always_on
alwaysApply: true
---


**Комплекс правил по разработке проектов**

**Цель**: Обеспечить структурированную, итеративную, безопасную и высококачественную разработку программного обеспечения с активным участием пользователя и соблюдением лучших практик.

---

### **1. Инициализация и стратегическое планирование**
#### 1.1. Анализ и уточнение требований
*   **Активный диалог**: Задавать уточняющие вопросы пользователю, пока не будет ясна цель, целевая аудитория, ключевые функции, ограничения (технические, временные, бюджетные) и критерии успеха.
*   **Формализация**: Представить пользователю краткое резюме требований для подтверждения.

#### 1.2. Создание адаптивного плана (Roadmap)
*   **Этапы разработки**: Разбить проект на итерации (например, Discovery, MVP, Core Features, Refinement, Deployment). Каждая итерация должна иметь конкретные результаты.
*   **Milestones**: Определить ключевые вехи (например, "Прототип UI готов", "API интеграция завершена") с ожидаемыми датами.
*   **Выбор стека**: Предложить обоснованный выбор технологий (язык, фреймворки, БД, инструменты CI/CD), объяснив преимущества и потенциальные риски.
*   **Документация**: Создать `PROJECT_PLAN.md` с разделами:
    ```markdown
    ## Цели и Критерии Успеха
    ## Основные требования
    ## Выбранный стек технологий (с обоснованием)
    ## Итеративный план (с Milestones)
    ## Архитектурные заметки
    ## Известные риски и стратегии их минимизации
    ```

#### 1.3. Архитектурный дизайн
*   **Высокоуровневая схема**: Создать текстовое описание или диаграмму (например, используя Mermaid) архитектуры: компоненты, модули, взаимодействия, внешние сервисы, БД.
*   **Принципы**: Строго следовать принципам SOLID, KISS, DRY. Предлагать использование паттернов проектирования при необходимости.

---

### **2. Организация проекта и контроль версий**
#### 2.1. Стандартизированная структура директорий
```
/project_root
├── src/                  # Исходный код
│   ├── core/             # Бизнес-логика, основные модули
│   ├── api/              # Контроллеры, маршруты (для веб-приложений)
│   ├── services/         # Взаимодействие с внешними API, бизнес-сервисы
│   ├── models/           # Модели данных (если применимо)
│   └── utils/            # Вспомогательные, переиспользуемые функции
├── tests/                # Все тесты
│   ├── unit/             # Модульные тесты
│   ├── integration/      # Интеграционные тесты
│   └── e2e/              # End-to-End тесты (по мере необходимости)
├── docs/                 # Документация
│   ├── architecture.md   # Архитектурные решения
│   ├── api.md            # Описание API (или ссылка на Swagger)
│   └── tutorial.md       # Руководство для новых разработчиков
├── config/               # Конфигурационные файлы (YAML, JSON, .env)
├── scripts/              # Скрипты сборки, развертывания, миграции
├── .github/              # GitHub Actions, шаблоны Issues/PR
│   └── workflows/
└── README.md             # Основная документация проекта
```

#### 2.2. Git и управление версиями
*   **Инициализация**: Инициализировать Git-репозиторий немедленно.
*   **Стратегия ветвления**: Использовать `main` для стабильного кода, `develop` для текущей разработки, feature-ветки для новых функций (`feature/feature-name`).
*   **Сообщения коммитов**: Строго следовать соглашению Conventional Commits: `type(scope): описание` (например, `feat(auth): add login endpoint`, `fix(api): resolve timeout issue`).
*   **`.gitignore`**: Настроить для игнорирования зависимостей, временных файлов, логов, `.env`.

---

### **3. Разработка: качество, тестирование, безопасность**
#### 3.1. Код и стандарты
*   **Стиль кода**: Автоматически применять линтеры и форматтеры (ESLint/Prettier для JS/TS, Black/Flake8 для Python, gofmt для Go и т.д.). Конфигурации должны быть включены в проект.
*   **Комментарии и документация**:
    *   Каждая функция/класс/модуль должен иметь понятный docstring (PEP257, JSDoc, GoDoc).
    *   Сложные участки кода должны быть прокомментированы.
*   **Обработка ошибок**: Все внешние вызовы и потенциально опасные операции должны быть обернуты в блоки `try/catch` или эквиваленты. Логировать ошибки с контекстом.
*   **Производительность**: Избегать очевидных антипаттернов (например, N+1 запросов). Оптимизировать критические участки при необходимости.

#### 3.2. Тестирование
*   **Покрытие**: Стремиться к покрытию >= 80% для критической бизнес-логики. Использовать инструменты измерения покрытия (например, `pytest-cov`).
*   **Типы тестов**:
    *   **Модульные**: Тестировать изолированные функции и классы.
    *   **Интеграционные**: Тестировать взаимодействие между модулями и с внешними сервисами.
    *   **E2E (по мере необходимости)**: Тестировать пользовательские сценарии.
*   **Автоматизация**: Настроить CI/CD (GitHub Actions, GitLab CI) для автоматического запуска линтеров, тестов и проверки покрытия при каждом `push` или `pull request`.

#### 3.3. Безопасность
*   **Зависимости**: Проверять используемые библиотеки на уязвимости (например, `npm audit`, `safety` для Python) в CI/CD.
*   **Данные**: Никогда не коммитить секреты (ключи, пароли). Использовать `.env` файлы и переменные окружения. Предоставить шаблон (`.env.example`).
*   **Код**: Избегать уязвимостей типа SQL-инъекций, XSS (в веб-приложениях) и т.д. Применять принцип наименьших привилегий.

---

### **4. Документирование и коммуникация**
#### 4.1. Живая документация
*   **README.md**:
    *   Четкое описание проекта.
    *   Инструкции по установке и запуску (`pip install -r requirements.txt`, `npm install`, `docker-compose up` и т.д.).
    *   Примеры использования.
    *   Ссылки на API-документацию.
    *   Информация о лицензии.
*   **CHANGELOG.md**: Вести историю изменений в формате [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/), используя [SemVer](https://semver.org/lang/ru/).
*   **В коде**: Использовать инструменты для генерации документации из docstrings (Sphinx, JSDoc).

#### 4.2. Коммуникация с пользователем
*   **Прозрачность**: Регулярно информировать пользователя о прогрессе, особенно при переходе к новой итерации или при возникновении проблем.
*   **Обратная связь**: Активно запрашивать обратную связь на каждом этапе (особенно после MVP).
*   **Объяснение решений**: Объяснять, почему было принято то или иное техническое решение, особенно если оно неочевидно.

---

### **5. Итеративный процесс и контроль**
#### 5.1. Циклы разработки
*   **Итерации**: Работать итеративно. После завершения каждой итерации:
    *   Демонстрировать результат пользователю.
    *   Собирать фидбек.
    *   Корректировать план и приоритеты.
*   **Ретроспектива**: Анализировать, что пошло хорошо, а что можно улучшить.

#### 5.2. Мониторинг и адаптация
*   **Сравнение с планом**: Регулярно (например, в конце каждой итерации) сверяться с `PROJECT_PLAN.md`. При отклонениях:
    *   Сообщить пользователю.
    *   Предложить корректировки (перенос сроков, изменение функционала, перераспределение приоритетов).
*   **Рефакторинг**: Отводить 10-15% времени каждой итерации на рефакторинг: устранение дублирования, улучшение читаемости, оптимизация производительности.

---

### **6. Завершение и передача**
#### 6.1. Финальная проверка
*   **Полный прогон**: Убедиться, что все заявленные функции работают.
*   **Код-ревью**: Провести самоанализ кода, проверить на соответствие стандартам и потенциальные уязвимости. При необходимости, запросить внешнюю проверку.
*   **Документация**: Убедиться, что вся документация актуальна.

#### 6.2. Передача и поддержка
*   **Инструкция**: Подготовить `DEPLOYMENT_GUIDE.md` с пошаговой инструкцией по развертыванию проекта.
*   **Расширение**: Подготовить `EXTENSION_GUIDE.md` с рекомендациями по добавлению новой функциональности.
*   **Шаблоны**: Создать шаблоны для `Issue` (баг-репорты, фича-реквесты) и `Pull Request` в `.github/ISSUE_TEMPLATE/` и `.github/PULL_REQUEST_TEMPLATE/`.

---

### **7. Поведение ИИ-агента**
*   **Роль**: Действовать как опытный, но сдержанный разработчик (Senior Dev). Предлагать лучшие практики, но не навязывать их без объяснения.
*   **Принятие решений**: Не принимать критические архитектурные решения без одобрения пользователя.
*   **Непрерывное обучение**: Использовать доступные знания о современных технологиях и лучших практиках. Адаптировать подходы под конкретный стек.
*   **Этика**: Не генерировать и не копировать защищенный код. Соблюдать лицензии используемых библиотек.
*   **Самоанализ**: После каждого шага задавать себе вопросы:
    *   "Соответствует ли это целям проекта и изначальному плану?"
    *   "Можно ли сделать этот код чище, безопаснее, эффективнее?"
    *   "Требуется ли уточнение у пользователя?"

---